<div class="container theme-showcase" role="main">

<div class="jumbotron">
	<h1>Search: "<%= @search_tag %>"</h1>
	<p>
		This page shows the press tracking results for the input tag.
	</p>
	<p>
		<%= link_to "New search >>", root_path, :class => "btn btn-warning btn-lg" %>
	</p>
</div>

<div class="page-header">
<h1>Number of articles found: <em id="number_of_articles_found">...</em></h1>
</div>

<div class="row">
	<div class="col-lg-6 col-md-6 portfolio-item">
        <a href="<%= @diffbot_api_response["resolved_url"] %>", target="_blank">
        	<% if @diffbot_api_response["images"].size > 0 %>
            	<img class="img-responsive" src="<%= @diffbot_api_response["images"][0]["url"] %>">
            <% else %>
            	<img class="img-responsive" src="http://placehold.it/700x400">
            <% end %>
        </a>
        <h3><a href="<%= @diffbot_api_response["resolved_url"] %>", target="_blank"><%= @diffbot_api_response["title"] %></a>
        </h3>
        <p class="lead">by <%= @diffbot_api_response["author"] %></p>
        <hr />
        <p><span class="glyphicon glyphicon-time"></span> Posted on <%= @diffbot_api_response["date"] %></p>
        <p>Url: <%= link_to @diffbot_api_response["resolved_url"] %></p>
        <hr />
        <p style="text-align: justify;"><%= @diffbot_api_response["text"].truncate(500) %></p>
    </div>
</div>

<div id="test">
</div>

<div class="page-header">
<h1>Complete tweet array</h1>
</div>

<table id="complete" class="table table-striped table-bordered table-hover dataTable no-footer">
	<thead>
		<tr>
		  <th style="min-width: 100px;">Created at</th>
		  <th>User</th>
		  <th style="min-width: 200px;">Text</th>
		  <th>Tags</th>
		</tr>
	</thead>
	
	<tbody>
	<% @tweets.each do |tweet| %>
		<tr> 
			<td><%= tweet["created_at"] %></td>
			<td><%= tweet["user"] %></td>
			<td><%= tweet["text"] %></td>
			<td><%= tweet["tags"].join(', ') %></td>	
		</tr>
	<% end %>
	</tbody>
</table>

</div>

<script>
$(document).ready(function() {
	$('#complete').dataTable({
		"bAutoWidth": false
	});
	var tweets = <%= raw @tweets.to_json %>;
	var completed_url_list = {};
	$.each(tweets, function(i, tweet) {
	  complete_url_list(completed_url_list, tweet.urls);
	});
	
	$('#number_of_articles_found').html(Object.keys(completed_url_list).length);
} );

function complete_url_list(completed_url_list, urls){
	for (var i=0,len=urls.length; i<len; i++){
		url = urls[i];
		var is_present;
		if (url in completed_url_list) {
			is_present = true;
			completed_url_list[url] += 1;
		}
		else {
			is_present = false;
			completed_url_list[url] = 1;
			$("#test").append("<p> "+ url + " </p>");
		}
	}
}
</script>
</div>
